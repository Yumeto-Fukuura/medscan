# アンケート画像解析ツール

このツールは、アンケート画像をBBox座標で切り出し、Gemini APIを使用して構造化解析を行うStreamlitアプリケーションです。

## 機能

- アンケート画像のアップロード
- BBox座標による画像セクション切り出し
- Gemini APIを使用した構造化解析
- JSON形式での結果出力

## セットアップ

### 1. 依存関係のインストール

```bash
# 仮想環境を作成
python3 -m venv venv

# 仮想環境をアクティベート
source venv/bin/activate

# 依存関係をインストール
pip install -r requirements.txt
```

### 2. Gemini APIキーの設定

1. [Google AI Studio](https://aistudio.google.com/) にアクセス
2. APIキーを取得
3. `.env`ファイルを作成し、APIキーを設定：

```bash
# .envファイルを作成
cp env_example.txt .env

# .envファイルを編集してAPIキーを設定
echo "GOOGLE_API_KEY=your_actual_api_key_here" > .env
```

## 使用方法

### 1. アプリケーションの起動

```bash
streamlit run questionnaire_analyzer.py
```

### 2. ブラウザでアクセス

アプリケーションが起動したら、ブラウザで `http://localhost:8501` にアクセスします。

### 3. 画像解析の手順

1. **APIキーの設定**: サイドバーでGemini APIキーを入力
2. **画像アップロード**: アンケート画像をアップロード
3. **解析実行**: 「画像を解析」ボタンをクリック
4. **結果確認**: 各セクションの解析結果を確認
5. **結果ダウンロード**: JSONファイルとして結果をダウンロード

## BBox座標

現在設定されているBBox座標：

```json
{
  "A": [47, 156, 880, 499],  // 仕事について
  "B": [47, 504, 880, 902],  // 最近1か月間の状態
  "C": [47, 906, 881, 1083], // 周りの方々について
  "D": [45, 1083, 320, 1200] // 満足度について
}
```

## 出力形式

各セクションの解析結果は以下の形式で出力されます：

```json
{
  "section": "A",
  "title": "あなたの仕事について",
  "questions": [
    {
      "number": 1,
      "question": "非常にたくさんの仕事をしなければならない",
      "answer": "そうだ"
    }
  ]
}
```

## 注意事項

- Gemini APIキーが必要です
- 画像の品質が解析精度に影響します
- チェックボックスの状態が明確に読み取れる画像を使用してください

## トラブルシューティング

### APIキーエラー
- APIキーが正しく設定されているか確認
- APIキーの有効期限を確認

### 解析エラー
- 画像の品質を確認
- チェックボックスが明確に表示されているか確認
- 画像サイズが適切か確認 